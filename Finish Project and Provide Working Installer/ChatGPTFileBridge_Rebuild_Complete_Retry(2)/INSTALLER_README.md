# WinBridgeAgent Installer Documentation

Part of WinBridgeAgent (c) 2025 Vladislav Manoilov

This document describes how to compile the WinBridgeAgent NSIS installer and the expected output structure.

## Prerequisites

1.  **NSIS (Nullsoft Scriptable Install System)**: Ensure `makensis` is installed and in your system's PATH. It can be downloaded from [https://nsis.sourceforge.io/](https://nsis.sourceforge.io/).
    On Debian/Ubuntu, it can be installed using: `sudo apt-get install nsis`
2.  **WinBridgeAgent Service Publish Output**: You need the published files of the WinBridgeAgent service. This is typically generated by running:
    `dotnet publish -c Release -r win-x64 --self-contained true`
    The output of this command (e.g., in `bin/Release/net8.0/win-x64/publish/`) should be placed in a directory named `publish_output` relative to the `WinBridgeAgentInstaller.nsi` script.
3.  **LICENSE.txt**: A `LICENSE.txt` file must be present in the same directory as the `WinBridgeAgentInstaller.nsi` script. This file will be displayed during the installation.

## Directory Structure for Compilation

Before compiling, your directory structure should look like this:

```
WinBridgeAgentInstaller/
|-- WinBridgeAgentInstaller.nsi  (The NSIS script)
|-- LICENSE.txt                  (The license file to be displayed)
|-- publish_output/              (Contains the output of `dotnet publish` for the service)
    |-- WinBridgeAgent.exe
    |-- appsettings.json
    |-- *.dll
    |-- runtimes/
    |-- ... (all other published files)
```

## Compilation Steps

1.  Navigate to the directory containing `WinBridgeAgentInstaller.nsi` (e.g., `WinBridgeAgentAddons/WinBridgeAgentInstaller/`).
2.  Run the `makensis` command:
    `makensis WinBridgeAgentInstaller.nsi`

3.  If the compilation is successful, it will produce `WinBridgeAgentInstaller.exe` in the same directory.

## Installer Output File Structure (After User Runs Installer)

The installer will, by default, install the WinBridgeAgent service to:
`C:\Program Files\WinBridgeAgent\` (or `C:\Program Files (x86)\WinBridgeAgent\` on 32-bit systems, though the script targets `$PROGRAMFILES64`)

The installed directory will contain:

-   `WinBridgeAgent.exe` (The service executable)
-   `appsettings.json` (Configuration file for the service)
-   All necessary DLLs and runtime files for the service to run.
-   `uninstall.exe` (The uninstaller for the service).

## Service Registration

The installer will:

1.  Create a Windows Service named "WinBridgeAgent".
2.  Set its display name to "WinBridge Agent Service (Vlad)".
3.  Set its description to "WinBridgeAgent Service - Secure File Access Bridge".
4.  Set its startup type to "Automatic".
5.  Attempt to start the service after installation.

## Uninstallation

The uninstaller (`uninstall.exe`) will:

1.  Attempt to stop the "WinBridgeAgent" service.
2.  Delete the "WinBridgeAgent" service registration.
3.  Remove all files from the installation directory.
4.  Remove the installation directory itself (if empty).
5.  Remove the uninstallation information from the registry.

## Notes

-   The installer requests administrator privileges to perform service registration and write to `Program Files`.
-   The `SOURCE_FILES_DIR` in the NSIS script is defined as `publish_output`. Ensure this directory exists and is populated correctly before compilation.
-   The version number in the script (`!define VERSION "0.1.0"`) should ideally be kept in sync with the actual service version.

